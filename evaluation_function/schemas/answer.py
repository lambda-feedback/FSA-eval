"""
Answer Parameter Schema

Defines how the correct answer/expected language can be specified:
- regex: Regular expression defining the language
- test_cases: List of input strings with expected accept/reject behavior
- reference_fsa: A reference FSA that accepts the correct language
- grammar: Formal grammar defining the language
"""

from typing import Any, Dict, List, Literal, Optional, Union
from pydantic import BaseModel, Field


class TestCase(BaseModel):
    """
    A single test case specifying expected FSA behavior on an input string.
    
    Example:
    {"input": "ab", "expected": true, "description": "Should accept strings ending in 'ab'"}
    """
    input: str = Field(
        ...,
        description="Input string to test (use empty string '' for epsilon/empty input)"
    )
    
    expected: bool = Field(
        ...,
        description="Expected result: true if FSA should accept this string, false if it should reject"
    )
    
    description: Optional[str] = Field(
        default=None,
        description="Optional explanation of what this test case validates"
    )


class RegexAnswer(BaseModel):
    """
    Answer specified as a regular expression.
    
    The student's FSA should accept the language defined by this regex.
    
    Example:
    {"type": "regex", "value": "(a|b)*ab"}
    """
    type: Literal["regex"] = "regex"
    
    value: str = Field(
        ...,
        description="Regular expression pattern defining the expected language"
    )


class TestCasesAnswer(BaseModel):
    """
    Answer specified as a set of test cases.
    
    The student's FSA is validated by testing it on these input strings.
    
    Example:
    {
        "type": "test_cases",
        "value": [
            {"input": "ab", "expected": true},
            {"input": "ba", "expected": false}
        ]
    }
    """
    type: Literal["test_cases"] = "test_cases"
    
    value: List[TestCase] = Field(
        ...,
        min_length=1,
        description="List of test cases to validate the FSA against"
    )


class ReferenceFSAAnswer(BaseModel):
    """
    Answer specified as a reference FSA.
    
    The student's FSA should accept the same language as this reference FSA.
    Uses the same structure as the FSA schema.
    
    Example:
    {
        "type": "reference_fsa",
        "value": {
            "states": ["q0", "q1"],
            "alphabet": ["a", "b"],
            "transitions": [...],
            "initial_state": "q0",
            "accept_states": ["q1"]
        }
    }
    """
    type: Literal["reference_fsa"] = "reference_fsa"
    
    value: Dict[str, Any] = Field(
        ...,
        description="Reference FSA that accepts the correct language (same structure as FSA schema)"
    )


class GrammarAnswer(BaseModel):
    """
    Answer specified as a formal grammar.
    
    The student's FSA should accept the language generated by this grammar.
    
    Example:
    {
        "type": "grammar",
        "value": {
            "start": "S",
            "productions": {
                "S": ["aS", "bS", "ab"]
            }
        }
    }
    """
    type: Literal["grammar"] = "grammar"
    
    value: Dict[str, Any] = Field(
        ...,
        description="Grammar definition with start symbol and production rules"
    )


# Union type representing any valid answer format
Answer = Union[RegexAnswer, TestCasesAnswer, ReferenceFSAAnswer, GrammarAnswer]
